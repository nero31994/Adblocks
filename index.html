<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NXB Ad-Free Player</title>
<style>
  body,html { margin:0; background:#000; height:100%; display:flex; justify-content:center; align-items:center; }
  #player { width:100%; height:100%; border:0; background:#000; }
  #loading { color:#fff; font-family:sans-serif; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
</style>
</head>
<body>
<div id="loading">Loading Player...</div>
<iframe id="player" allowfullscreen allow="autoplay; fullscreen"></iframe>

<script>
(async () => {
  const params = new URLSearchParams(window.location.search);
  const rawUrl = params.get("url");
  if (!rawUrl) {
    document.body.innerHTML = "<h2 style='color:white'>No URL provided.</h2>";
    return;
  }

  const proxyBase = "https://vidsrcprxy.vercel.app/api/proxy/";

  try {
    const resp = await fetch(proxyBase + rawUrl.replace(/^https?:\/\//, ""));
    let html = await resp.text();

    // Remove ad layers, popups, and unwanted scripts
    html = html
      .replace(/<script[^>]*histats[^>]*>[\s\S]*?<\/script>/gi, "")
      .replace(/window\.open\s*\([^)]*\)/gi, "")
      .replace(/(top|window)\.location\s*=\s*[^;]+;/gi, "")
      .replace(/<a[^>]+target=['"]?_blank['"]?[^>]*>[\s\S]*?<\/a>/gi, "")
      .replace(/setInterval\s*\([^)]*redirect[^)]*\)/gi, "");

    // create a blob to sandbox the cleaned page
    const blob = new Blob([html], { type: "text/html" });
    const blobUrl = URL.createObjectURL(blob);

    const frame = document.getElementById("player");
    frame.src = blobUrl;
    frame.onload = () => document.getElementById("loading").style.display = "none";
  } catch (e) {
    document.body.innerHTML = "<h2 style='color:white'>Error loading player.</h2>";
    console.error(e);
  }
})();
</script>
</body>
</html>
